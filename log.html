<head>
<meta charset="UTF-8">
<meta http-equiv="Cache-Control" content="no-store">
<title>TEST by IK4LZH</title>
<link rel="stylesheet" href="log.css?v=105">
</head>
<body>
<table>
<td><pre>
Call <input type="text" id="call">
</pre></td>
<td id="myq1">
<button id="a01">List</button>
<button id="a02">&#8679;</button>
<button id="a03">&#8681;</button>
<button id="a04">R</button>
<button id="a05">G</button>
<br>
<button id="a06">Find</button>
<button id="a07">&#8679;</button>
<button id="a08">&#8681;</button>
<br>
<button id="a09">Apply</button>
<button id="a10">Report</button>
<br>
<button id="a11">Curio</button>
<button id="a12">Activity</button>
</td>
<td id="myq1">
<button id="a13">ReSerialize1m</button>
<button id="a14">ReSerialize6m</button>
</td>
</table>
<div id="out"></div>
<div id="debug"></div>
<script type="module">
const out = document.getElementById("out");
const callInput = document.getElementById("call");
callInput.addEventListener("keydown", e => {
  if (e.key === ",") e.preventDefault();
});
callInput.addEventListener("input", e => {
  if (callInput.value.includes(",")) {
    callInput.value = callInput.value.replace(/,/g, "");
  }
});
let page = 0;
let mypage = 30;
document.querySelectorAll("button[id]").forEach(btn => {
  if (/^a\d{2}$/.test(btn.id)) {
    btn.addEventListener("click", async () => {
      if (btn.id === "a01" || btn.id === "a06") page = 0;
      else if (btn.id === "a02" || btn.id === "a07") page -= mypage;
      else if (btn.id === "a03" || btn.id === "a08") page += mypage;
      if (page < 0) page = 0;
      const r = await fetch("proclog.cgi", {
        method: "POST", cache: "no-store", credentials: "same-origin",
        headers: {"Content-Type": "text/csv"},
        body: ["3KY2pRIOeP8x44ht",btn.id,page,mypage,callInput.value.trim().toUpperCase()||"-"].join(",")
      });
      if (btn.id === "a05") {
        page = parseInt(await r.text(), 10) || 0;
        document.getElementById("a04").click();
      }
      else out.innerHTML = await r.text();
      document.getElementById("debug").innerHTML=`page:${page}`;
    });
  }
});
</script>

</body>
